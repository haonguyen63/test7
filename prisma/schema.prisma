generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  STAFF
  MANAGER
  ADMIN
}

model User {
  id             String   @id @default(cuid())
  phone          String   @unique
  username       String?  @unique
  name           String   // ← CỘT NÀY BẮT BUỘC
  hashedPassword String
  role           Role     @default(STAFF)

  orders         Order[]
  createdUsers   User[]   @relation("ManagedUsers")
  manager        User?    @relation("ManagedUsers", fields: [managedBy], references: [id])
  managedBy      String?

  customers      Customer[]

  @@map("users")
}

model Customer {
  id        String   @id @default(cuid())
  phone     String   @unique
  name      String   // ← CỘT NÀY CŨNG BẮT BUỘC
  points    Int      @default(0)

  orders    Order[]
  staff     User?    @relation(fields: [staffId], references: [id])
  staffId   String?

  @@map("customers")
}

model Order {
  id           String   @id @default(cuid())
  customerId   String
  customer     Customer @relation(fields: [customerId], references: [id])
  staffId      String
  staff        User     @relation(fields: [staffId], references: [id])

  amount       Int      // VND
  pointsEarned Int
  pointsUsed   Int      @default(0)
  discount     Int      @default(0)

  createdAt    DateTime @default(now())

  @@map("orders")
}
